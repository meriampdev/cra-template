pipeline:
  setup:
    image: node:latest
    commands: 
      - npm install
      - npm install -g serve
      - npm run build 

  deploy:
    image: maoxuner/drone-ssh-deploy
    settings:
      host: 159.203.105.174
      user: yamyam
      key:
        from_secret: private_key
      deploy_path: /cra-template
      source: .
      exclude:
        - .git
        - .gitignore
      shared_dirs:
        - storage
      shared_files:
        - .env
      writable_dirs:
        - storage/
        - logs
      writable_mode: chown
      writable_chown_user: www-data:www-data
      writable_use_sudo: true
      writable_recursive: true
      script:
        - pwd
        - ls
        - serve -s build
      debug_mode: false